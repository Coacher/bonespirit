http://devel.aegisub.org/ticket/1904#comment:10

diff --git a/Makefile.inc.in b/Makefile.inc.in
index d8b3f4a..25fd5a2 100644
--- a/Makefile.inc.in
+++ b/Makefile.inc.in
@@ -9,6 +9,7 @@ HAVE_OPENAL     = @with_openal@
 HAVE_OSS        = @with_oss@
 HAVE_PORTAUDIO  = @with_portaudio@
 HAVE_UCHARDET   = @with_uchardet@
+SYSTEM_LUAJIT   = @system_luajit@

 ##############
 # BUILD OUTPUT
diff --git a/automation/Makefile b/automation/Makefile
index 5483dbd..1231aab 100644
--- a/automation/Makefile
+++ b/automation/Makefile
@@ -12,10 +12,16 @@ DATA_AUTOMATION_INSTALLED = $(addprefix $(DESTDIR)$(P_DATA)/automation/, $(DATA_
 $(DESTDIR)$(P_DATA)/automation/%: $(d)%
 	$(MKDIR_INSTALL)

-aegisub-lua_OBJ := $(d)tests/aegisub.o $(TOP)lib/libaegisub.a $(TOP)lib/libluabins.a $(LIBS_LUA)
+aegisub-lua_OBJ := $(d)tests/aegisub.o $(TOP)lib/libaegisub.a $(TOP)lib/libluabins.a
 aegisub-lua_CPPFLAGS := $(CPPFLAGS_BOOST) $(CFLAGS_LUA) -I$(TOP)libaegisub/include -I$(TOP)src $(CXXFLAGS_WX)
 aegisub-lua_LIBS := $(LIBS_WX) $(LIBS_BOOST) $(LIBS_ICU) $(LIBS_PTHREAD)

+ifeq (no, $(SYSTEM_LUAJIT))
+aegisub-lua_OBJ += $(LIBS_LUA)
+else
+aegisub-lua_LIBS += $(LIBS_LUA)
+endif
+
 PROGRAM += $(d)aegisub-lua

 test-automation: $(PROGRAM)
diff --git a/header.mk b/header.mk
index 613b38f..8edb48e 100644
--- a/header.mk
+++ b/header.mk
@@ -12,8 +12,11 @@ subdirs := \
 	src \
 	tests \
 	tools \
-	vendor/luabins \
-	vendor/luajit
+	vendor/luabins
+
+ifeq (no, $(SYSTEM_LUAJIT))
+subdirs += vendor/luajit
+endif

 subdirs := $(addprefix $(TOP),$(addsuffix /Makefile,$(subdirs)))

diff --git a/src/Makefile b/src/Makefile
index 0ee6c84..852f78e 100644
--- a/src/Makefile
+++ b/src/Makefile
@@ -6,7 +6,8 @@ src_CPPFLAGS := -I$(d) -I.. -I$(d)include -I$(TOP)libaegisub/include -I$(TOP)bui
 	$(CFLAGS_PTHREAD) $(CFLAGS_FFTW3) $(CFLAGS_ICU) $(CPPFLAGS_BOOST)
 src_CXXFLAGS := $(CXXFLAGS_WX)
 src_LIBS := $(LIBS_GL) $(LIBS_PTHREAD) $(LIBS_WX) $(LIBS_FREETYPE) \
-	$(LIBS_LIBASS) $(LIBS_FONTCONFIG) $(LIBS_FFTW3)  $(LIBS_BOOST) $(LIBS_ICU)
+	$(LIBS_LIBASS) $(LIBS_FONTCONFIG) $(LIBS_FFTW3) $(LIBS_BOOST) $(LIBS_ICU) \
+	$(LIBS_LUA)
 src_PCH := $(d)agi_pre.h
 src_INSTALLNAME := $(AEGISUB_COMMAND)

@@ -111,11 +112,14 @@ src_OBJ := \
 	$(d)video_provider_yuv4mpeg.o \
 	$(d)video_slider.o \
 	$(d)visual_feature.o \
-	$(LIBS_LUA) \
 	$(TOP)lib/libaegisub.a \
 	$(TOP)lib/libluabins.a \
 	$(TOP)lib/libresrc.a \

+ifeq (no, $(SYSTEM_LUAJIT))
+src_OBJ += $(LIBS_LUA)
+endif
+
 ifeq (yes, $(BUILD_DARWIN))
 src_OBJ += $(d)font_file_lister_coretext.o
 src_OBJ += $(subst .mm,.o,$(wildcard $(d)osx/*.mm))
